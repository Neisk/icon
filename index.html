<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>视频库</title>
<style>
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
background:#0d0d0d;color:#f5f5f5;text-align:center;padding:20px;}
h1{color:#00b7ff;margin-bottom:20px;}
.gallery{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:15px;max-width:1200px;margin:auto;}
.card{background:#222;border-radius:12px;overflow:hidden;cursor:pointer;transition:0.2s;}
.card:hover{transform:translateY(-3px);box-shadow:0 6px 15px rgba(0,0,0,0.3);}
.card img{width:100%;height:120px;object-fit:cover;background:#000;}
.card .title{padding:6px 8px;font-size:14px;font-weight:600;}
#playerContainer{margin-top:20px;}
#player{width:90%;max-width:800px;background:#000;}
#pagination{margin-top:20px;}
#pagination button{margin:0 5px;padding:6px 12px;border:none;border-radius:8px;background:#222;color:#fff;cursor:pointer;}
#pagination button:hover{background:#00b7ff;color:#000;}
#pagination button.active{background:#00b7ff;color:#000;}
</style>
</head>
<body>
<h1>📺 视频库</h1>
<div class="gallery" id="gallery">正在加载视频...</div>

<div id="playerContainer">
  <video id="player" controls></video>
</div>

<div id="pagination"></div>

<script>
const folder = "mp4"; // 所有视频直接放这里
const gallery = document.getElementById("gallery");
const player = document.getElementById("player");
const paginationDiv = document.getElementById("pagination");
let videos = [];
let currentPage = 1;
const pageSize = 6;

// 获取文件夹下所有视频
fetch(`https://api.github.com/repos/Neisk/icon/contents/${folder}`)
  .then(res=>res.json())
  .then(data=>{
    videos = data.filter(f=>f.name.endsWith(".mp4")||f.name.endsWith(".mov"))
      .map(f=>({
        name: f.name,
        url:`https://cdn.jsdelivr.net/gh/Neisk/icon@main/${folder}/${encodeURIComponent(f.name)}`
      }));
    renderGallery();
    renderPagination();
  })
  .catch(e=>{
    gallery.innerHTML="❌ 视频加载失败";
    console.error(e);
  });

// 渲染当前页
function renderGallery(){
  gallery.innerHTML="";
  const start = (currentPage-1)*pageSize;
  const pageVideos = videos.slice(start,start+pageSize);
  pageVideos.forEach((v,i)=>{
    const card = document.createElement("div");
    card.className="card";

    const img = document.createElement("img");
    img.src = "default_cover.jpg"; // 默认封面，可放仓库根目录
    const videoEl = document.createElement("video");
    videoEl.src=v.url;
    videoEl.muted=true;
    videoEl.currentTime=0.1;

    videoEl.addEventListener("loadeddata",()=>{
      try {
        const canvas=document.createElement("canvas");
        canvas.width=videoEl.videoWidth;
        canvas.height=videoEl.videoHeight;
        const ctx=canvas.getContext("2d");
        ctx.drawImage(videoEl,0,0,canvas.width,canvas.height);
        img.src=canvas.toDataURL("image/jpeg");
      } catch(e){
        img.src="default_cover.jpg";
      }
    });
    videoEl.addEventListener("error",()=>{img.src="default_cover.jpg";});

    const title = document.createElement("div");
    title.className="title";
    title.textContent=v.name;

    card.appendChild(img);
    card.appendChild(title);

    card.onclick=()=>{
      player.src=v.url;
      player.pause(); // 点击播放模式
      player.load();
      player.scrollIntoView({behavior:"smooth"});
      // 高亮当前播放
      Array.from(gallery.children).forEach(c=>c.classList.remove("active"));
      card.classList.add("active");
    }

    gallery.appendChild(card);
  });
}

// 分页
function renderPagination(){
  paginationDiv.innerHTML="";
  const totalPage = Math.ceil(videos.length/pageSize);
  if(totalPage<=1) return;
  if(currentPage>1){
    const prev=document.createElement("button");
    prev.textContent="上一页";
    prev.onclick=()=>{currentPage--; renderGallery(); renderPagination();}
    paginationDiv.appendChild(prev);
  }
  if(currentPage<totalPage){
    const next=document.createElement("button");
    next.textContent="下一页";
    next.onclick=()=>{currentPage++; renderGallery(); renderPagination();}
    paginationDiv.appendChild(next);
  }
}
</script>
</body>
</html>
